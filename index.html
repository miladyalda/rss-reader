<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>News Feed</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 2rem;
    }
    #feed {
      max-width: 800px;
      margin: 0 auto;
    }
    .feed-item {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 16px;
      margin-bottom: 24px;
    }
    .feed-item img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 12px;
    }
    .feed-item h3 {
      margin: 0;
      font-size: 20px;
    }
    .feed-item a {
      text-decoration: none;
      color: #1a0dab;
    }
    .meta {
      font-size: 13px;
      color: #777;
      margin: 8px 0;
    }
    .description {
      font-size: 15px;
      color: #333;
    }
  </style>
</head>
<body>
  <div id="feed"><em>Loading feed...</em></div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const proxy = 'https://your-glitch-proxy.glitch.me/'; // Replace with your working proxy
      const rawFeedUrl = 'https://www.newsmachine.com/personalfeed/937aed90c2986818bd5c1f98ed0d2c4f.rss';
      const feedUrl = proxy + rawFeedUrl;

      fetch(feedUrl)
        .then(response => response.text())
        .then(xml => {
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(xml, 'text/xml');
          const items = xmlDoc.querySelectorAll('item');
          const feedDiv = document.getElementById('feed');
          feedDiv.innerHTML = '';

          items.forEach(item => {
            const title = item.querySelector('title')?.textContent || 'No title';
            const link = item.querySelector('link')?.textContent || '#';
            const description = item.querySelector('description')?.textContent || '';
            const pubDateRaw = item.querySelector('pubDate')?.textContent || '';
            const pubDate = pubDateRaw ? new Date(pubDateRaw).toLocaleDateString() : '';
            const domain = link.replace(/^https?:\/\//, '').split('/')[0];

            const feedItem = document.createElement('div');
            feedItem.classList.add('feed-item');
            feedItem.innerHTML = `
              <h3><a href="${link}" target="_blank">${title}</a></h3>
              <div class="meta">${domain} â€¢ ${pubDate}</div>
              <div class="description">${description}</div>
            `;

            // Try to fetch og:image from the linked page
            const imageProxy = proxy + link;
            fetch(imageProxy)
              .then(response => response.text())
              .then(html => {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                const ogImage = doc.querySelector('meta[property="og:image"]');
                const imgUrl = ogImage?.getAttribute('content');
                if (imgUrl) {
                  const img = document.createElement('img');
                  img.src = imgUrl;
                  img.alt = title;
                  feedItem.insertBefore(img, feedItem.firstChild);
                }
              })
              .catch(err => console.warn("No preview image found", err));

            feedDiv.appendChild(feedItem);
          });
        })
        .catch(error => {
          console.error('Failed to fetch feed:', error);
          document.getElementById('feed').innerText = 'Could not load feed.';
        });
    });
  </script>
</body>
</html>
