const feedUrl = 'https://corsproxy.io/?' + encodeURIComponent('https://www.newsmachine.com/personalfeed/937aed90c2986818bd5c1f98ed0d2c4f.rss');

fetch(feedUrl)
  .then(response => response.text())
  .then(xml => {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xml, 'text/xml');
    const items = xmlDoc.querySelectorAll('item');

    items.forEach(item => {
      const title = item.querySelector('title')?.textContent || 'No title';
      const link = item.querySelector('link')?.textContent || '#';
      const description = item.querySelector('description')?.textContent || '';
      const pubDateRaw = item.querySelector('pubDate')?.textContent || '';
      const pubDate = pubDateRaw ? new Date(pubDateRaw).toDateString() : '';
      const source = item.querySelector('creator')?.textContent || 'NewsMachine';

      const feedDiv = document.getElementById('feed');
      const feedItem = document.createElement('div');
      feedItem.classList.add('feed-item');
      feedItem.innerHTML = `
        <h3><a href="${link}" target="_blank">${title}</a></h3>
        <p class="source">${source}</p>
        <p>${description}</p>
        <p class="date">${pubDate}</p>
      `;

      // Optional: try loading preview image
      const imageProxy = 'https://corsproxy.io/?' + encodeURIComponent(link);
      fetch(imageProxy)
        .then(response => response.text())
        .then(html => {
          const doc = new DOMParser().parseFromString(html, 'text/html');
          const metaImage = doc.querySelector('meta[property="og:image"]');
          const imageUrl = metaImage?.getAttribute('content');
          if (imageUrl) {
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = title;
            feedItem.insertBefore(img, feedItem.firstChild);
          }
        }).catch(error => console.warn('Image preview failed:', error));

      feedDiv.appendChild(feedItem);
    });
  })
  .catch(error => console.error('Error loading RSS feed:', error));
